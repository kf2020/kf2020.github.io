---
title: "320 Final Project"
author: "Amy, Katie, Shawdi"
date: "5/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r message=FALSE, warning=FALSE}
library(rvest)
library(tidyverse)
url <-"html_top100.txt"
college_urls <- url %>%
  read_html() %>%
  html_node("body") %>% html_nodes("ol[class~=bEyEue]") %>% html_nodes("li[id]")%>% html_nodes("h3") %>% 
html_nodes("a[href]") %>%
  html_attr("href") 
college_urls

```


```{r message=FALSE, warning=FALSE}
index_num <- 0

college_tab <-  data.frame("URL" = gsub(" ", "", paste("https://www.usnews.com",college_urls, sep = "")), 
"CollegeName"= "", "TuitionFees" = 0, "RoomBoard" = 0, "TotalEnrollment" = 0, "SchoolType" = "", "YearFounded" = 0, "Setting" = "", "Endowment2017(Millions)" = 0, "MedianStartingSalaryOfAlumni" = 0, "Selectivity" = "", "Fall2017AcceptanceRate" = 0, "GenderDistribution" = 0, "FourYearGraduationRate" = 0, stringsAsFactors = FALSE) 

college_tab
```


```{r}
#retrieve data and populate fields of dataframe
for (i in 1:nrow(college_tab)){
  url_html <- college_tab[i,1] %>%read_html()
  college_tab[i,]$CollegeName <- url_html %>% html_node("body") %>% html_nodes("h1[class~=hero-heading]") %>% html_text()
  college_tab[i,]$Fall2017AcceptanceRate <- url_html %>% html_node("span[data-test-id~=r_c_accept_rate]") %>% html_text()
}
#fix spacing of College Name
college_tab$CollegeName <- sub("^\n        ","",college_tab$CollegeName)
college_tab$CollegeName <-sub("\n    ","",college_tab$CollegeName)
#fixing Acceptance Rate
college_tab$Fall2017AcceptanceRate <- sub("\n            ","",college_tab$Fall2017AcceptanceRate)
college_tab$Fall2017AcceptanceRate <- sub("%","",college_tab$Fall2017AcceptanceRate)
college_tab$Fall2017AcceptanceRate <- as.double(college_tab$Fall2017AcceptanceRate)
college_tab$Fall2017AcceptanceRate <- college_tab$Fall2017AcceptanceRate/100


college_tab
```


```{r}
#Amy
#Setting
#retrieve data and populate fields of dataframe

for (i in 1:nrow(college_tab)){
  url_html <- college_tab[i,1] %>%read_html()
  temp_vector <- url_html %>% html_node("body") %>% html_nodes("div[id~=content-main]") %>%html_nodes("div[class~=flex-row]") %>%   html_nodes("span[class~=heading-small]") %>% html_text()
  college_tab[i,]$SchoolType <- temp_vector[1]
  college_tab[i,]$YearFounded <- temp_vector[2]
  college_tab[i,]$Setting <- temp_vector[5]
  college_tab[i,]$Endowment2017(Millions) <- temp_vector[6]

}
college_tab$SchoolType <- as.factor(college_tab$SchoolType)
college_tab$Setting <- as.factor(college_tab$Setting)
college_tab$YearFounded <- as.integer(college_tab$YearFounded)


college_tab$Endowment2017(Millions) <-sub("[[:punct:]]", "",college_tab$Endowment2017(Millions))
college_tab$Endowment2017(Millions) <-sub(" \\+", "",college_tab$Endowment2017(Millions))

college_tab$Endowment2017(Millions) <- ifelse(grepl("billion", college_tab$Endowment2017(Millions)), sub("\\.","",college_tab$Endowment2017(Millions)),college_tab$Endowment2017(Millions))
college_tab$Endowment2017(Millions) <-sub(" billion","00",college_tab$Endowment2017(Millions))
college_tab$Endowment2017(Millions) <-sub(" million","",college_tab$Endowment2017(Millions))

college_tab

```

